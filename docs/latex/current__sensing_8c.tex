\doxysection{MS\+\_\+\+RF\+\_\+\+Board/src/\+Current\+Sensing/current\+\_\+sensing.c File Reference}
\hypertarget{current__sensing_8c}{}\label{current__sensing_8c}\index{MS\_RF\_Board/src/CurrentSensing/current\_sensing.c@{MS\_RF\_Board/src/CurrentSensing/current\_sensing.c}}


Current Sensing Software Component (SWC) for MS\+\_\+\+RF\+\_\+\+Board.  


{\ttfamily \#include "{}current\+\_\+sensing.\+h"{}}\newline
{\ttfamily \#include "{}esp\+\_\+log.\+h"{}}\newline
{\ttfamily \#include "{}esp\+\_\+adc/adc\+\_\+oneshot.\+h"{}}\newline
{\ttfamily \#include "{}esp\+\_\+adc/adc\+\_\+cali.\+h"{}}\newline
{\ttfamily \#include "{}esp\+\_\+adc/adc\+\_\+cali\+\_\+scheme.\+h"{}}\newline
{\ttfamily \#include "{}freertos/\+Free\+RTOS.\+h"{}}\newline
{\ttfamily \#include "{}freertos/task.\+h"{}}\newline
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{current__sensing_8c_afc3d101f633a076cc1ca84b85b6224b2}{TAG}}~"{}Current\+Sensing"{}
\item 
\#define \mbox{\hyperlink{current__sensing_8c_a63baed8df076ce9dddaea1ae8694c1d8}{DEFAULT\+\_\+\+VREF}}~1100
\item 
\#define \mbox{\hyperlink{current__sensing_8c_a80534669f8249303c92ccb58e19c4458}{CURRENT\+\_\+\+SENSE\+\_\+\+RESISTOR}}~0.\+015
\item 
\#define \mbox{\hyperlink{current__sensing_8c_a23355696f4644d6e2eb33dc21e441efe}{CURRENT\+\_\+\+SENSE\+\_\+\+GAIN}}~20.\+0
\item 
\#define \mbox{\hyperlink{current__sensing_8c_a83d3945d15fed15b11d91b44a4b6ef3d}{CURRENT\+\_\+\+LIMIT\+\_\+\+SAFE}}~0.\+1
\item 
\#define \mbox{\hyperlink{current__sensing_8c_a2856f30bec96a819a50033baa653b671}{SENSOR\+\_\+1\+\_\+\+CHANNEL}}~ADC\+\_\+\+CHANNEL\+\_\+4
\item 
\#define \mbox{\hyperlink{current__sensing_8c_a64f0d1ebf3de5a3a23c273d7f4d30ad3}{SENSOR\+\_\+2\+\_\+\+CHANNEL}}~ADC\+\_\+\+CHANNEL\+\_\+7
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{current__sensing_8c_aa2b5d5131ffb73df0b95b297d19cdd2b}{current\+\_\+sensing\+\_\+init}} ()
\begin{DoxyCompactList}\small\item\em Initialize the current sensing module. \end{DoxyCompactList}\item 
float \mbox{\hyperlink{current__sensing_8c_a2fd520948a1a94b10b169c14024f124d}{current\+\_\+sensing\+\_\+get\+\_\+debounced}} (\mbox{\hyperlink{current__sensing_8h_a785728f49ef7f6245c219ceb32cc070a}{current\+\_\+sensor\+\_\+t}} sensor)
\begin{DoxyCompactList}\small\item\em Get the debounced current measurement from a specific sensor. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{current__sensing_8c_a4fc7857163650346e69447ef36bb7bed}{current\+\_\+sensing\+\_\+update}} (\mbox{\hyperlink{current__sensing_8h_a785728f49ef7f6245c219ceb32cc070a}{current\+\_\+sensor\+\_\+t}} sensor)
\begin{DoxyCompactList}\small\item\em Update the debounced current buffer for a specific sensor. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{current__sensing_8c_a2c5526dedfaebc125ae1f86a5779fd43}{current\+\_\+sensing\+\_\+process}} ()
\begin{DoxyCompactList}\small\item\em Cyclically process current updates for all sensors. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{current__sensing_8c_a4b5de34fc5ae069707ad8fa60a680621}{current\+\_\+sensing\+\_\+set\+\_\+limit}} (float limit)
\begin{DoxyCompactList}\small\item\em Set the app-\/defined current limit. \end{DoxyCompactList}\item 
float \mbox{\hyperlink{current__sensing_8c_af4bf9dcd8ca1efb523282595407ed350}{current\+\_\+sensing\+\_\+get\+\_\+limit}} ()
\begin{DoxyCompactList}\small\item\em Get the app-\/defined current limit. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{current__sensing_8c_a86dea9a69f74319728052fa593525a65}{current\+\_\+sensing\+\_\+deinit}} ()
\begin{DoxyCompactList}\small\item\em Deinitialize the current sensing module. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Current Sensing Software Component (SWC) for MS\+\_\+\+RF\+\_\+\+Board. 

This module monitors the current passing through the load and provides an interface for the gate driver module to retrieve raw and debounced current measurements. The gate driver uses this information to decide when to disable or enable the gate.

\begin{DoxyDate}{Date}
2025-\/01-\/26 
\end{DoxyDate}


Definition in file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.



\doxysubsection{Macro Definition Documentation}
\Hypertarget{current__sensing_8c_a83d3945d15fed15b11d91b44a4b6ef3d}\index{current\_sensing.c@{current\_sensing.c}!CURRENT\_LIMIT\_SAFE@{CURRENT\_LIMIT\_SAFE}}
\index{CURRENT\_LIMIT\_SAFE@{CURRENT\_LIMIT\_SAFE}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{CURRENT\_LIMIT\_SAFE}{CURRENT\_LIMIT\_SAFE}}
{\footnotesize\ttfamily \label{current__sensing_8c_a83d3945d15fed15b11d91b44a4b6ef3d} 
\#define CURRENT\+\_\+\+LIMIT\+\_\+\+SAFE~0.\+1}



Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00028}{28}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

\Hypertarget{current__sensing_8c_a23355696f4644d6e2eb33dc21e441efe}\index{current\_sensing.c@{current\_sensing.c}!CURRENT\_SENSE\_GAIN@{CURRENT\_SENSE\_GAIN}}
\index{CURRENT\_SENSE\_GAIN@{CURRENT\_SENSE\_GAIN}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{CURRENT\_SENSE\_GAIN}{CURRENT\_SENSE\_GAIN}}
{\footnotesize\ttfamily \label{current__sensing_8c_a23355696f4644d6e2eb33dc21e441efe} 
\#define CURRENT\+\_\+\+SENSE\+\_\+\+GAIN~20.\+0}



Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00025}{25}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

\Hypertarget{current__sensing_8c_a80534669f8249303c92ccb58e19c4458}\index{current\_sensing.c@{current\_sensing.c}!CURRENT\_SENSE\_RESISTOR@{CURRENT\_SENSE\_RESISTOR}}
\index{CURRENT\_SENSE\_RESISTOR@{CURRENT\_SENSE\_RESISTOR}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{CURRENT\_SENSE\_RESISTOR}{CURRENT\_SENSE\_RESISTOR}}
{\footnotesize\ttfamily \label{current__sensing_8c_a80534669f8249303c92ccb58e19c4458} 
\#define CURRENT\+\_\+\+SENSE\+\_\+\+RESISTOR~0.\+015}



Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00024}{24}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

\Hypertarget{current__sensing_8c_a63baed8df076ce9dddaea1ae8694c1d8}\index{current\_sensing.c@{current\_sensing.c}!DEFAULT\_VREF@{DEFAULT\_VREF}}
\index{DEFAULT\_VREF@{DEFAULT\_VREF}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{DEFAULT\_VREF}{DEFAULT\_VREF}}
{\footnotesize\ttfamily \label{current__sensing_8c_a63baed8df076ce9dddaea1ae8694c1d8} 
\#define DEFAULT\+\_\+\+VREF~1100}



Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00023}{23}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

\Hypertarget{current__sensing_8c_a2856f30bec96a819a50033baa653b671}\index{current\_sensing.c@{current\_sensing.c}!SENSOR\_1\_CHANNEL@{SENSOR\_1\_CHANNEL}}
\index{SENSOR\_1\_CHANNEL@{SENSOR\_1\_CHANNEL}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{SENSOR\_1\_CHANNEL}{SENSOR\_1\_CHANNEL}}
{\footnotesize\ttfamily \label{current__sensing_8c_a2856f30bec96a819a50033baa653b671} 
\#define SENSOR\+\_\+1\+\_\+\+CHANNEL~ADC\+\_\+\+CHANNEL\+\_\+4}



Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00038}{38}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

\Hypertarget{current__sensing_8c_a64f0d1ebf3de5a3a23c273d7f4d30ad3}\index{current\_sensing.c@{current\_sensing.c}!SENSOR\_2\_CHANNEL@{SENSOR\_2\_CHANNEL}}
\index{SENSOR\_2\_CHANNEL@{SENSOR\_2\_CHANNEL}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{SENSOR\_2\_CHANNEL}{SENSOR\_2\_CHANNEL}}
{\footnotesize\ttfamily \label{current__sensing_8c_a64f0d1ebf3de5a3a23c273d7f4d30ad3} 
\#define SENSOR\+\_\+2\+\_\+\+CHANNEL~ADC\+\_\+\+CHANNEL\+\_\+7}



Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00039}{39}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

\Hypertarget{current__sensing_8c_afc3d101f633a076cc1ca84b85b6224b2}\index{current\_sensing.c@{current\_sensing.c}!TAG@{TAG}}
\index{TAG@{TAG}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{TAG}{TAG}}
{\footnotesize\ttfamily \label{current__sensing_8c_afc3d101f633a076cc1ca84b85b6224b2} 
\#define TAG~"{}Current\+Sensing"{}}



Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00020}{20}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.



\doxysubsection{Function Documentation}
\Hypertarget{current__sensing_8c_a86dea9a69f74319728052fa593525a65}\index{current\_sensing.c@{current\_sensing.c}!current\_sensing\_deinit@{current\_sensing\_deinit}}
\index{current\_sensing\_deinit@{current\_sensing\_deinit}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{current\_sensing\_deinit()}{current\_sensing\_deinit()}}
{\footnotesize\ttfamily \label{current__sensing_8c_a86dea9a69f74319728052fa593525a65} 
void current\+\_\+sensing\+\_\+deinit (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Deinitialize the current sensing module. 

Cleans up resources used by the current sensing module. 

Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00175}{175}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

\Hypertarget{current__sensing_8c_a2fd520948a1a94b10b169c14024f124d}\index{current\_sensing.c@{current\_sensing.c}!current\_sensing\_get\_debounced@{current\_sensing\_get\_debounced}}
\index{current\_sensing\_get\_debounced@{current\_sensing\_get\_debounced}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{current\_sensing\_get\_debounced()}{current\_sensing\_get\_debounced()}}
{\footnotesize\ttfamily \label{current__sensing_8c_a2fd520948a1a94b10b169c14024f124d} 
float current\+\_\+sensing\+\_\+get\+\_\+debounced (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{current__sensing_8h_a785728f49ef7f6245c219ceb32cc070a}{current\+\_\+sensor\+\_\+t}}}]{sensor}{}\end{DoxyParamCaption})}



Get the debounced current measurement from a specific sensor. 

Averages the last 5 current measurements to provide a stable reading.


\begin{DoxyParams}{Parameters}
{\em sensor} & The current sensor to retrieve debounced data from (SENSOR\+\_\+1 or SENSOR\+\_\+2). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The debounced load current in amperes. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00114}{114}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

\Hypertarget{current__sensing_8c_af4bf9dcd8ca1efb523282595407ed350}\index{current\_sensing.c@{current\_sensing.c}!current\_sensing\_get\_limit@{current\_sensing\_get\_limit}}
\index{current\_sensing\_get\_limit@{current\_sensing\_get\_limit}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{current\_sensing\_get\_limit()}{current\_sensing\_get\_limit()}}
{\footnotesize\ttfamily \label{current__sensing_8c_af4bf9dcd8ca1efb523282595407ed350} 
float current\+\_\+sensing\+\_\+get\+\_\+limit (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Get the app-\/defined current limit. 

\begin{DoxyReturn}{Returns}
The app-\/defined current limit in amperes. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00166}{166}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

\Hypertarget{current__sensing_8c_aa2b5d5131ffb73df0b95b297d19cdd2b}\index{current\_sensing.c@{current\_sensing.c}!current\_sensing\_init@{current\_sensing\_init}}
\index{current\_sensing\_init@{current\_sensing\_init}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{current\_sensing\_init()}{current\_sensing\_init()}}
{\footnotesize\ttfamily \label{current__sensing_8c_aa2b5d5131ffb73df0b95b297d19cdd2b} 
void current\+\_\+sensing\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Initialize the current sensing module. 

Configures the ADC to read current measurements and sets up calibration. 

Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00046}{46}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

\Hypertarget{current__sensing_8c_a2c5526dedfaebc125ae1f86a5779fd43}\index{current\_sensing.c@{current\_sensing.c}!current\_sensing\_process@{current\_sensing\_process}}
\index{current\_sensing\_process@{current\_sensing\_process}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{current\_sensing\_process()}{current\_sensing\_process()}}
{\footnotesize\ttfamily \label{current__sensing_8c_a2c5526dedfaebc125ae1f86a5779fd43} 
void current\+\_\+sensing\+\_\+process (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Cyclically process current updates for all sensors. 

This function is called periodically to ensure the buffers for all sensors are updated. 

Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00146}{146}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

\Hypertarget{current__sensing_8c_a4b5de34fc5ae069707ad8fa60a680621}\index{current\_sensing.c@{current\_sensing.c}!current\_sensing\_set\_limit@{current\_sensing\_set\_limit}}
\index{current\_sensing\_set\_limit@{current\_sensing\_set\_limit}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{current\_sensing\_set\_limit()}{current\_sensing\_set\_limit()}}
{\footnotesize\ttfamily \label{current__sensing_8c_a4b5de34fc5ae069707ad8fa60a680621} 
void current\+\_\+sensing\+\_\+set\+\_\+limit (\begin{DoxyParamCaption}\item[{float}]{limit}{}\end{DoxyParamCaption})}



Set the app-\/defined current limit. 


\begin{DoxyParams}{Parameters}
{\em limit} & The current limit in amperes. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00156}{156}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

\Hypertarget{current__sensing_8c_a4fc7857163650346e69447ef36bb7bed}\index{current\_sensing.c@{current\_sensing.c}!current\_sensing\_update@{current\_sensing\_update}}
\index{current\_sensing\_update@{current\_sensing\_update}!current\_sensing.c@{current\_sensing.c}}
\doxysubsubsection{\texorpdfstring{current\_sensing\_update()}{current\_sensing\_update()}}
{\footnotesize\ttfamily \label{current__sensing_8c_a4fc7857163650346e69447ef36bb7bed} 
void current\+\_\+sensing\+\_\+update (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{current__sensing_8h_a785728f49ef7f6245c219ceb32cc070a}{current\+\_\+sensor\+\_\+t}}}]{sensor}{}\end{DoxyParamCaption})}



Update the debounced current buffer for a specific sensor. 

Reads the raw current and updates the buffer for debouncing.


\begin{DoxyParams}{Parameters}
{\em sensor} & The current sensor to update (SENSOR\+\_\+1 or SENSOR\+\_\+2). \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{current__sensing_8c_source_l00131}{131}} of file \mbox{\hyperlink{current__sensing_8c_source}{current\+\_\+sensing.\+c}}.

